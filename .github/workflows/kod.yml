name: Monitor PDF Count

on:
  schedule:
    - cron: '*/3 * * * *'  # Sprawdza stronÄ™ co minutÄ™
  workflow_dispatch:  # MoÅ¼liwoÅ›Ä‡ rÄ™cznego uruchomienia

permissions:
  contents: write  # Pozwala na commitowanie zmian

jobs:
  check_website:
    runs-on: ubuntu-latest

    steps:
      - name: Pobranie repozytorium
        uses: actions/checkout@v3  # Pobiera pliki repozytorium

      - name: Instalacja zaleÅ¼noÅ›ci Pythona
        run: pip install requests beautifulsoup4

      - name: Uruchomienie skryptu sprawdzajÄ…cego PDF-y
        id: check  # <--- Dodajemy ID kroku
        run: python kod.py

      - name: Commit zmian jeÅ›li wykryto rÃ³Å¼nice
        if: failure()  # <--- Teraz commitujemy TYLKO jeÅ›li `kod.py` zwrÃ³ci 1
        run: |
          git config --global user.name "github-actions"
          git config --global user.email "actions@github.com"
          git add changes.txt cache.txt
          git commit -m "ğŸ“Œ Wykryto zmianÄ™ w liczbie 'pdf'!" && git push

      - name: WysÅ‚anie e-maila, jeÅ›li wykryto zmianÄ™
        if: failure()  # <--- E-mail tylko jeÅ›li `kod.py` zwrÃ³ciÅ‚ 1
        uses: dawidd6/action-send-mail@v3
        with:
          server_address: smtp.gmail.com
          server_port: 587
          username: ${{ secrets.EMAIL_SENDER }}
          password: ${{ secrets.EMAIL_PASSWORD }}
          subject: "ğŸ”´ Wykryto zmianÄ™ w PDF-ach!"
          body: "Liczba 'pdf' na stronie siÄ™ zmieniÅ‚a!\n\n$(cat changes.txt)"
          to: ${{ secrets.EMAIL_RECEIVER }}
          from: "Monitor Strony <${{ secrets.EMAIL_SENDER }}>"
