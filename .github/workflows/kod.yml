name: Monitor PDF Count

on:
  schedule:
    - cron: '*/1 * * * *'  # Sprawdza stronÄ™ co minutÄ™
  workflow_dispatch:  # MoÅ¼liwoÅ›Ä‡ rÄ™cznego uruchomienia

permissions:
  contents: write  # Pozwala na commitowanie zmian

jobs:
  check_website:
    runs-on: ubuntu-latest

    steps:
      - name: Pobranie repozytorium
        uses: actions/checkout@v3  # Pobiera pliki repozytorium

      - name: Instalacja zaleÅ¼noÅ›ci Pythona
        run: pip install requests beautifulsoup4

      - name: Uruchomienie skryptu sprawdzajÄ…cego PDF-y
        run: python kod.py

      - name: Commit zmian jeÅ›li wykryto rÃ³Å¼nice
        if: success()
        run: |
          git config --global user.name "github-actions"
          git config --global user.email "actions@github.com"
          git add changes.txt cache.txt
          git diff --cached --exit-code || (git commit -m "ðŸ“Œ Wykryto zmianÄ™ w liczbie 'pdf'!" && git push)

      - name: WysÅ‚anie e-maila, jeÅ›li wykryto zmianÄ™
        if: success()
        uses: dawidd6/action-send-mail@v3
        with:
          server_address: smtp.gmail.com
          server_port: 587
          username: ${{ secrets.EMAIL_SENDER }}
          password: ${{ secrets.EMAIL_PASSWORD }}
          subject: "ðŸ”´ Wykryto zmianÄ™ w PDF-ach!"
          body: "Liczba 'pdf' na stronie siÄ™ zmieniÅ‚a!\n\n$(cat changes.txt)"
          to: ${{ secrets.EMAIL_RECEIVER }}
          from: "Monitor Strony <${{ secrets.EMAIL_SENDER }}>"
